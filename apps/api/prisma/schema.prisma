generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// 1. ENTIDAD: COACH
// ==========================================
model Coach {
  id           String   @id @default(uuid())
  email        String   @unique
  password     String
  orgName      String?
  planType     String   @default("free")
  createdAt    DateTime @default(now())
  
  clients      Client[]
}

// ==========================================
// 2. ENTIDAD: CLIENT (Con Riesgo y Readiness)
// ==========================================
model Client {
  id             String   @id @default(uuid())
  coachId        String
  name           String
  email          String?
  goal           String
  
  // BiometrÃ­a
  age            Int      @default(25)
  weight         Float    @default(70)
  height         Int      @default(170)
  gender         String   @default("male")
  activityLevel  String   @default("active")
  injuries       String?
  equipment      String   @default("full_gym")

  // --- NUEVOS CAMPOS RADAR ðŸ“¡ ---
  riskScore      Int      @default(0)       // 0-100 (Probabilidad de Churn)
  readiness      String   @default("High")  // High, Medium, Low

  createdAt      DateTime @default(now())

  // Relaciones
  coach          Coach    @relation(fields: [coachId], references: [id])
  plans          Plan[]
  metricLogs     MetricLog[]
}

// ==========================================
// 3. ENTIDAD: PLAN (Mesociclos)
// ==========================================
model Plan {
  id             String   @id @default(uuid())
  clientId       String
  weeks          Int
  focus          String
  status         String   @default("draft")
  blocks         Json     // Estructura compleja del plan
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  client         Client   @relation(fields: [clientId], references: [id])
}

// ==========================================
// 4. ENTIDAD: METRIC LOG
// ==========================================
model MetricLog {
  id             String   @id @default(uuid())
  clientId       String
  date           DateTime @default(now())
  sleepHours     Float?
  soreness       Int?
  hrv            Int?
  restingHr      Int?
  
  client         Client   @relation(fields: [clientId], references: [id])
}